{% extends "_base_landing.html"%}
{% block content %}
<div class="container">
    <div id="hp-content">
        <div class="wrapper">

            {{novinky}}

            {% if stage(config.YEAR, 'PROGRAM') %}
                {% include '_program.html' %}
            {% endif %}

            <!-- {% if stage(config.YEAR, 'USERS') %}
                <h2>Moje účast</h2>
                {% if going(user, config.YEAR) %}
                    <p class="menu center menu-button"><a class="gray" href="{{url_for('attend_remove')}}">
                            <i class="icon-remove icon-white"></i>
                            Už nechci přijít</a>
                {% else %}
                    <a name="go"></a>
                    <p class="menu center menu-button"><a href="{{url_for('attend_add')}}">
                            <i class="icon-heart icon-white"></i>
                            Chci přijít na Barcamp</a>
                </p><div class="clearer"></div>
                {% endif %}
            {% else %}
                <h2>Kdy budou registrace účastníků?</h2>
                <p></p>
                <p class="menu center menu-button"><a href="{{url_for('static_page', page='informace')}}">
                        <i class="icon-bullhorn icon-white"></i>
                        Registrace účasti začnou 1. 5. 2016</a>
                </p>
            {% endif %} -->
            {% if stage(config.YEAR, 'CALL-FOR-PAPERS') or after_stage(config.YEAR, 'CALL-FOR-PAPERS') %}
                <!-- prednasejici -->
                <h2>Program{% if stage(config.YEAR, 'VOTING') %} &amp; hlasování{% endif %}</h2>
                
                <h3>Témata volená účastníky <small>(42 míst)</small></h3>
                <div id="talks" class="row">
                    {% for talk in talks %}
                        <div id="talk-{{talk.talk_hash}}" class="talk-block col-md-3 col-sm-4 col-xs-12 {{'fail' if loop.index > 42 and after_stage(config.YEAR, 'VOTING') }}">
                            <p>
                                <a href="{{url_for('talk_detail', talk_hash=talk.talk_hash)}}">{{talk.title|no_emoji}}</a>
                            </p>
                            <p>{{talk.user.name|no_emoji}}</p>
                            <a href="#" class="pull-right" onclick="
                                var hadClass = $('#talk-{{talk.talk_hash}}').hasClass('more');
                                $('.more').removeClass('more');
                                if(!hadClass){
                                    $('#talk-{{talk.talk_hash}}').addClass('more');
                                }
                                return false;
                            ">
                                <span class="fa-stack">
                                    <i class="fa fa-circle-thin fa-stack-2x"></i>
                                    <i class="fa fa-angle-down fa-stack-1x icon-open"></i>
                                    <i class="fa fa-angle-up fa-stack-1x icon-close"></i>
                                </span>
                            </a>
                            {% if stage(config.YEAR, 'VOTING') %}
                                <div class="voting">
                                    {% if going(user, config.YEAR) and stage(config.YEAR, 'VOTING') %}
                                        <a href="{{url_for('vote_for_talk', talk_hash=talk.talk_hash, method='decrease' if talk.talk_hash in user_votes else 'increase')}}"
                                            data-increase="{{url_for('vote_for_talk', talk_hash=talk.talk_hash, method='increase')}}"
                                            data-decrease="{{url_for('vote_for_talk', talk_hash=talk.talk_hash, method='decrease')}}"
                                            data-next-action="{{'decrease' if talk.talk_hash in user_votes else 'increase'}}">
                                    {% endif %}
                                    {% if talk.talk_hash in user_votes %}
                                        <span class="caption">
                                            <i class="fa fa-star"></i> ty a {{talk.score -1 or 0|int}} hlasů
                                        </span>
                                        <span class="caption-hover">
                                            <i class="fa fa-star-o"></i> zrušit hlas
                                        </span>
                                    {% else %}
                                        <span class="caption">
                                            <i class="fa fa-star-o"></i> {{talk.score or 0|int}} hlasů
                                        </span>
                                        <span class="caption-hover">
                                            <i class="fa fa-star"></i> přidat hlas
                                        </span>
                                    {% endif %}
                                    {% if going(user, config.YEAR) and stage(config.YEAR, 'VOTING') %}
                                        </a>
                                    {% endif %}    
                                </div>
                            {% endif %}
                            <div class="detail">
                                <p>{{talk.description}}</p>
                                <h3>Pro koho</h3>
                                <p>{{talk.purpose or "---"}}</p>
                                <h3>O autorovi</h3>
                                <p>{{talk.user.bio or "---"}}</p>
                            </div>
                        </div>
                    {% else %}
                        <div>Zatím zde nic není</div>
                    {% endfor %}
                </div>
                
                {% if stage(config.YEAR, 'CALL-FOR-PAPERS') %}
                <p class="menu center menu-button"><a class="btn btn-danger" href="{{url_for('talk_edit')}}">
                            <i class="fa fa-bullhorn"></i>
                            Máš co říct? Přidej své téma</a>
                </p><div class="clearer"></div>
                {% endif %}
            {% endif %}

            {% if stage(config.YEAR, 'CALL-FOR-WORKSHOPS') or after_stage(config.YEAR, 'CALL-FOR-WORKSHOPS') %}
                <h2>Přihlášené workshopy</h2>
                 <table class="table" id="workshops">
                    {% for workshop in workshops %}
                        <tr class="{% if workshop.status != 'approved' %}fail{% endif %}">
                            <th>
                                <a href="{{url_for('workshop_detail', workshop_hash=workshop.workshop_hash)}}">{{workshop.title}}</a>
                            </th>
                            <td>{{workshop.user.name}}</td>
                            <td class="shadow-name">{{status(workshop.status)}}</td>
                        </tr>
                    {% else %}
                        <div>Zatím zde nic není</div>
                    {% endfor %}
                </table>
                {% if stage(config.YEAR, 'CALL-FOR-WORKSHOPS') %}
                <p class="menu center menu-button"><a class="btn btn-danger" href="{{url_for('workshop_edit')}}">
                            <i class="fa fa-bullhorn"></i>
                            Chceš udělat na Barcampu workshop? Přidej ho!</a>
                </p><div class="clearer"></div>
                {% endif %}
            {% endif %}


            <!-- workshopy -->
            <!-- {{ workshops }} -->

            <!-- sponzori -->
            <!-- <h2>Hlavní partneři akce</h2>
            <p class="sponsors">
                {{sponsors_main}}
            </p>
            
            <h2>Partneři akce</h2>
            <p class="sponsors">
                {{sponsors}}
            </p>

            <h2>Mediální partneři</h2>
            <p class="sponsors">
                {{sponsors_medial}}
            </p> -->
            <!-- / sponzori -->

            {% if stage(config.YEAR, 'USERS') %}
                <a name="entrants"></a>
                <h2>Účastníci</h2>
                <p>Právě je přihlášeno <strong>{{entrant_count}}</strong> účastníků.</p>
                <a href="{{url_for('entrants')}}">Kompletní seznam účastníků</a>
                
                {% if entrants %}
                <ul id="entrants">
                {% for entrant in entrants %}
                    <li><a href="{{url_for('profile', user_hash=entrant.user_hash)}}">{{entrant.name}}</a></li>
                {% endfor %}
                    <li>... <a href="{{url_for('entrants')}}"> a spousta dalších</a></li>
                </ul>
                {% endif %}
            
                {% if going(user, config.YEAR) %}
                    <p class="menu center menu-button"><a class="gray" href="{{url_for('attend_remove')}}">
                            <i class="icon-remove icon-white"></i>
                            Už nechci přijít</a>
                {% else %}
                    <a name="go"></a>
                    <p class="menu center menu-button"><a href="{{url_for('attend_add')}}">
                            <i class="icon-heart icon-white"></i>
                            Chci přijít na Barcamp</a>
                </p><div class="clearer"></div>
                {% endif %}
            {% endif %}
            
            </p>
        </div>
    </div>
</div>

<script type="text/javascript">
$(document).ready(function(){
    $('.talk-block .voting a').click(function(event){
        event.preventDefault();
        var self = $(this);
        var nextAction = self.data('next-action');
        var action = self.data(nextAction);

        var caption = "přidávám tvůj hlas";
        if (nextAction == 'decrease') {
            caption = "odebírám tvůj hlas";
        }
        $('.caption', self).html('<i class="fa fa-spinner fa-pulse"></i> ' + caption);
        $('.caption-hover', self).html('<i class="fa fa-spinner fa-pulse"></i> ' + caption);

        $.ajax(action, {
            'accept': 'application/json',
            'success': function(data){
                var voteCount = parseInt(data);

                if (nextAction == 'increase') {
                    $('.caption', self).html('<i class="fa fa-star"></i> ty a ' + (voteCount - 1) + ' hlasů');
                    $('.caption-hover', self).html('<i class="fa fa-star-o"></i> zrušit hlas');
                    self.data('next-action', 'decrease');
                } else {
                    $('.caption', self).html('<i class="fa fa-star-o"></i> ' + voteCount + ' hlasů');
                    $('.caption-hover', self).html('<i class="fa fa-star"></i> přidat hlas');
                    self.data('next-action', 'increase');
                }
            },
            'error':  function(){

            },
        });

        return false;
    });
});
</script>
{% endblock %}